// This is your Prisma schema file.
// Learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String    @id @default(uuid())
  name         String    @db.VarChar(100)
  email        String    @unique @db.VarChar(150)
  passwordHash String    @map("password_hash") @db.VarChar(255)
  phone        String?   @db.VarChar(20)
  createdAt    DateTime  @default(now()) @map("created_at")
  
  // Relations
  events        Event[]
  notifications Notification[]
  venueReviews  VenueReview[]
  mealReviews   MealReview[]

  @@index([email])
  @@index([createdAt])
  @@map("users")
}

model Organizer {
  id           String   @id @default(uuid())
  name         String   @db.VarChar(100)
  email        String   @unique @db.VarChar(150)
  passwordHash String   @map("password_hash") @db.VarChar(255)
  phone        String?  @db.VarChar(20)
  createdAt    DateTime @default(now()) @map("created_at")

  @@index([email])
  @@index([createdAt])
  @@map("organizers")
}

model Venue {
  id           String     @id @default(uuid())
  name         String     @db.VarChar(150)
  description  String?    @db.Text
  
  // Location Details
  address      String     @db.Text
  city         String     @db.VarChar(100)
  state        String     @db.VarChar(100)
  zipCode      String?    @map("zip_code") @db.VarChar(20)
  country      String     @default("Bangladesh") @db.VarChar(100)
  latitude     Decimal?   @db.Decimal(10, 8)
  longitude    Decimal?   @db.Decimal(11, 8)
  
  // Venue Details
  capacity     Int
  area         Decimal?   @db.Decimal(10, 2) // in square feet
  venueType    String     @map("venue_type") @db.VarChar(50) // indoor, outdoor, hybrid
  
  // Pricing
  pricePerHour Decimal    @map("price_per_hour") @db.Decimal(10, 2)
  minimumHours Int        @default(4) @map("minimum_hours")
  securityDeposit Decimal? @map("security_deposit") @db.Decimal(10, 2)
  
  // Facilities & Amenities
  facilities   String[]   // ["parking", "ac", "wifi", "sound_system", "lighting", "stage", "kitchen", "restrooms", "wheelchair_accessible"]
  amenities    String[]   // ["bridal_room", "groom_room", "vip_lounge", "dance_floor", "bar_area", "outdoor_space"]
  
  // Services
  cateringAllowed Boolean @default(true) @map("catering_allowed")
  decorationAllowed Boolean @default(true) @map("decoration_allowed")
  alcoholAllowed Boolean @default(false) @map("alcohol_allowed")
  smokingAllowed Boolean @default(false) @map("smoking_allowed")
  petFriendly  Boolean @default(false) @map("pet_friendly")
  
  // Media
  images       String[]   // Array of image URLs
  virtualTourUrl String? @map("virtual_tour_url") @db.Text
  
  // Contact & Availability
  contactPerson String?  @map("contact_person") @db.VarChar(100)
  contactPhone String?   @map("contact_phone") @db.VarChar(20)
  contactEmail String?   @map("contact_email") @db.VarChar(150)
  
  // Operating Hours
  operatingHours Json?    @map("operating_hours") // {"monday": {"open": "09:00", "close": "23:00"}, ...}
  
  // Status & Ratings
  isActive     Boolean   @default(true) @map("is_active")
  rating       Decimal?  @db.Decimal(3, 2) // Average rating out of 5
  totalReviews Int       @default(0) @map("total_reviews")
  
  // Timestamps
  createdAt    DateTime  @default(now()) @map("created_at")
  updatedAt    DateTime  @updatedAt @map("updated_at")
  
  // Relations
  events       Event[]
  reviews      VenueReview[]

  @@index([city])
  @@index([venueType])
  @@index([capacity])
  @@index([pricePerHour])
  @@index([isActive])
  @@index([rating])
  @@index([createdAt])
  @@index([city, venueType])
  @@index([capacity, pricePerHour])
  @@map("venues")
}

model Meal {
  id             String  @id @default(uuid())
  name           String  @db.VarChar(100)
  description    String? @db.Text
  
  // Meal Details
  type           String  @db.VarChar(50) // veg, nonveg, buffet, plated
  cuisine        String? @db.VarChar(50) // bengali, indian, chinese, continental, etc.
  servingStyle   String  @map("serving_style") @db.VarChar(50) // buffet, plated, family_style
  
  // Pricing
  pricePerPerson Decimal @map("price_per_person") @db.Decimal(10, 2)
  minimumGuests  Int     @default(50) @map("minimum_guests")
  
  // Menu Details
  menuItems      Json?   @map("menu_items") // {"appetizers": [...], "main_course": [...], "desserts": [...]}
  beverages      String[] // ["tea", "coffee", "soft_drinks", "juices", "water"]
  specialDietary String[] @map("special_dietary") // ["halal", "kosher", "gluten_free", "dairy_free", "nut_free"]
  
  // Service Details
  serviceHours   Json?   @map("service_hours") // {"setup": 1, "service": 3, "cleanup": 1}
  staffIncluded  Boolean @default(true) @map("staff_included")
  equipmentIncluded Boolean @default(true) @map("equipment_included") // plates, utensils, etc.
  
  // Media
  images         String[] // Array of food images
  
  // Availability & Status
  isActive       Boolean @default(true) @map("is_active")
  isPopular      Boolean @default(false) @map("is_popular")
  
  // Ratings
  rating         Decimal? @db.Decimal(3, 2)
  totalReviews   Int     @default(0) @map("total_reviews")
  
  // Timestamps
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")
  
  // Relations
  events         Event[]
  reviews        MealReview[]

  @@index([type])
  @@index([cuisine])
  @@index([servingStyle])
  @@index([pricePerPerson])
  @@index([isActive])
  @@index([isPopular])
  @@index([rating])
  @@index([type, cuisine])
  @@index([pricePerPerson, minimumGuests])
  @@map("meals")
}

model Event {
  id          String    @id @default(uuid())
  userId      String    @map("user_id")
  venueId     String    @map("venue_id")
  mealId      String?   @map("meal_id")
  eventType   String    @map("event_type") @db.VarChar(100) // marriage, birthday, etc.
  peopleCount Int       @map("people_count")
  startTime   DateTime  @map("start_time")
  endTime     DateTime  @map("end_time")
  totalCost   Decimal?  @map("total_cost") @db.Decimal(10, 2)
  status      String    @default("pending") @db.VarChar(50) // pending, confirmed, cancelled
  createdAt   DateTime  @default(now()) @map("created_at")
  
  // Relations
  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  venue        Venue         @relation(fields: [venueId], references: [id], onDelete: Cascade)
  meal         Meal?         @relation(fields: [mealId], references: [id])
  payments     Payment[]
  venueReviews VenueReview[]
  mealReviews  MealReview[]

  @@index([userId])
  @@index([venueId])
  @@index([mealId])
  @@index([eventType])
  @@index([status])
  @@index([startTime])
  @@index([endTime])
  @@index([createdAt])
  @@index([startTime, endTime]) // Composite index for time range queries
  @@map("events")
}

model Payment {
  id            String   @id @default(uuid())
  eventId       String   @map("event_id")
  amount        Decimal  @db.Decimal(10, 2)
  method        String?  @db.VarChar(50) // card, bkash, etc.
  status        String   @default("pending") @db.VarChar(50) // pending, success, failed
  transactionId String?  @map("transaction_id") @db.VarChar(255)
  createdAt     DateTime @default(now()) @map("created_at")
  
  // Relations
  event Event @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@index([eventId])
  @@index([status])
  @@index([transactionId])
  @@index([createdAt])
  @@map("payments")
}

model VenueReview {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  venueId   String   @map("venue_id")
  eventId   String?  @map("event_id") // Optional link to the event
  
  // Review Details
  rating    Int      // 1-5 stars
  title     String?  @db.VarChar(200)
  comment   String?  @db.Text
  
  // Review Categories (1-5 each)
  cleanlinessRating Int? @map("cleanliness_rating")
  serviceRating     Int? @map("service_rating")
  facilitiesRating  Int? @map("facilities_rating")
  valueRating       Int? @map("value_rating")
  
  // Status
  isVerified Boolean @default(false) @map("is_verified")
  isVisible  Boolean @default(true) @map("is_visible")
  
  // Timestamps
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  
  // Relations
  user  User  @relation(fields: [userId], references: [id], onDelete: Cascade)
  venue Venue @relation(fields: [venueId], references: [id], onDelete: Cascade)
  event Event? @relation(fields: [eventId], references: [id])

  @@index([venueId])
  @@index([userId])
  @@index([rating])
  @@index([isVisible])
  @@index([createdAt])
  @@map("venue_reviews")
}

model MealReview {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  mealId    String   @map("meal_id")
  eventId   String?  @map("event_id") // Optional link to the event
  
  // Review Details
  rating    Int      // 1-5 stars
  title     String?  @db.VarChar(200)
  comment   String?  @db.Text
  
  // Review Categories (1-5 each)
  tasteRating       Int? @map("taste_rating")
  presentationRating Int? @map("presentation_rating")
  serviceRating     Int? @map("service_rating")
  valueRating       Int? @map("value_rating")
  
  // Status
  isVerified Boolean @default(false) @map("is_verified")
  isVisible  Boolean @default(true) @map("is_visible")
  
  // Timestamps
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  
  // Relations
  user  User @relation(fields: [userId], references: [id], onDelete: Cascade)
  meal  Meal @relation(fields: [mealId], references: [id], onDelete: Cascade)
  event Event? @relation(fields: [eventId], references: [id])

  @@index([mealId])
  @@index([userId])
  @@index([rating])
  @@index([isVisible])
  @@index([createdAt])
  @@map("meal_reviews")
}

model Notification {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  message   String   @db.Text
  isRead    Boolean  @default(false) @map("is_read")
  createdAt DateTime @default(now()) @map("created_at")
  
  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isRead])
  @@index([createdAt])
  @@index([userId, isRead]) // Composite index for user's unread notifications
  @@map("notifications")
}